/*
 * Biowulf Local profile - for local execution on allocated Biowulf node
 */

env {
    RESOURCE_DIR = "/workspace/References"
    ANALYSES_DIR = "${params.project_dir}/analyses"
    GENOTYPES_DIR = "${params.project_dir}/genotypes"
}

workDir = "${params.project_dir}/work"

process {
    executor = 'local'
    container = "${params.STORE_ROOT}/Docker/long-gwas-pipeline.sif"
    maxForks = 2  // Limit parallel tasks to match your allocation
    
    withLabel: small {
        cpus = 2
        memory = '4 GB'
        time = '2h'
    }
    
    withLabel: medium {
        cpus = 2
        memory = '8 GB'
        time = '4h'
    }
    
    withLabel: large {
        cpus = 2  // Limited to prevent overload
        memory = '16 GB'
        time = '8h'
    }
    
    withLabel: very_large {
        cpus = 2
        memory = '64 GB'
        time = '12h'
    }

    withLabel: two_cpu_large_mem {
        cpus = 2
        memory = '64 GB'
        time = '2h'
    }
}

singularity {
    enabled = true
    autoMounts = true
    cacheDir = '/data/$USER/singularity_cache'
    runOptions = "--bind ${projectDir} --bind ${params.reference_dir}:/workspace/References --env APPEND_PATH=${projectDir}/bin --env TMPDIR=/tmp --env XDG_RUNTIME_DIR=/tmp --cleanenv"
}
